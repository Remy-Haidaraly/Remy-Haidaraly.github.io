---
title: DOWN BAD
categories: [Forensic_TFC_CTF_2023]
tags: [png]
image: '/assets/images/TFC_CTF_2023/main.jpg'
---

## ùÑû Introduction

![Intro](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/intro.png)

## ùÑû Solution

Pour r√©soudre ce d√©fi de forensic, j'ai commenc√© par analyser l'image.  
Lorsque nous essayons d'ouvrir l'image, une erreur appara√Æt :  

![Erreur](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/crc_2.png)

![Analysis](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/analysis.png)

L'analyse de l'image r√©v√®le plusieurs points :

- La **taille** de l'image peut sembler √©trange, 1920x1168, alors qu'on observe g√©n√©ralement des tailles plus courantes telles que 1920x1080 ou 1920x1200.  
- Le type **MIME** indique qu'il s'agit d'un PNG, donc la signature du PNG est pr√©sente au d√©but du fichier. Cependant, dans les m√©tadonn√©es, Il y a des r√©f√©rences au mot **PDF**, ce qui pourrait √™tre une piste.  
- En utilisant l'outil **pngcheck**, nous d√©tectons une erreur **CRC** dans le **chunk IHDR** de l'image, n√©cessitant ainsi une correction de notre part.


## ùÑûùÑû Correction du CRC dans le chunck IHDR

Pour cela, nous allons modifier l'image en examinant son contenu en hexad√©cimal. L'outil **pngcheck** nous a donn√© le **CRC incorrect**, qui est **0xa9d545b**.

![Hex](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/hex.png)

Nous trouvons le **CRC incorrect** dans le **chunk IHDR**, et nous allons le remplacer par la valeur correcte donn√©e par **pngcheck**, qui est **0x1d9c52c0**.

## ùÑûùÑû Analyse de l'image

Apr√®s la correction du CRC, nous obtenons cette image :

![CRC](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/crc.png)

On remarque que l'image semble tronqu√©e, ce qui explique sa dimension de **1920x1168**. Nous allons donc essayer d'augmenter la **hauteur** de l'image.  
J'ai commenc√© par essayer **1920x1200** :
Pour cela, je vais modifier la partie correspondant √† la **hauteur dans le chunk IHDR**.

![Taille](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/taille.png)

En bleu, nous avons la repr√©sentation de la **largeur** de l'image, qui est **1920** en d√©cimal (0x780 en hexad√©cimal), et la valeur de la **hauteur**, qui est **1168** en d√©cimal (0x490 en hexad√©cimal). Maintenant, pour modifier la **hauteur** de l'image, je vais remplacer la valeur hexad√©cimale correspondante (0x490) par celle de 1200, qui est 0x4B0.

Une fois modifi√©e, en essayant d'ouvrir notre nouvelle image :

![CRC_2](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/crc_2.png)

Nous obtenons une erreur de CRC, ce qui est tout √† fait normal, car nous avons modifi√© les donn√©es de l'image. Cependant, nous pouvons quand m√™me v√©rifier si notre changement a fonctionn√© en v√©rifiant la hauteur de notre image.

![Hauteur](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/hauteur.png)

> Le CRC est un algorithme de v√©rification d'int√©grit√© utilis√© pour d√©tecter les erreurs de donn√©es lors de leur transmission. Lorsque vous modifiez les donn√©es d'une image, y compris sa taille, le contenu des pixels change, et donc les donn√©es de l'image sont diff√©rentes. Le CRC est calcul√© √† partir des donn√©es brutes de l'image, donc m√™me un petit changement dans les donn√©es entra√Ænera un CRC diff√©rent. Pour maintenir un CRC valide apr√®s avoir modifi√© la taille d'une image, vous devez recalculer le CRC en utilisant l'algorithme de CRC adapt√© aux nouvelles donn√©es. Cela implique g√©n√©ralement de recalculer le CRC sur l'ensemble des donn√©es de l'image apr√®s qu'elle ait √©t√© modifi√©e.
{: .prompt-tip }



## ùÑûùÑû Calculez le CRC de l'image. 

Pour simplifier notre t√¢che, j'ai utilis√© un[outil](https://github.com/sherlly/PCRT) qui permet de recalculer facilement le CRC apr√®s modification.


![Solve](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/solve.png)

L'image avec ces nouvelles dimensions ne nous donne rien, alors j'ai essay√© de viser plus grand en prenant une **hauteur** de **2100**, soit **0x834** en hexad√©cimal, et j'ai recalcul√© le CRC. Bingo !


![Flag](/assets/images/TFC_CTF_2023/Forensics/Down_BAD/flag.png)

ùÑû FLAG : `TFCCTF{28ae25c96850245ffdd70a880158f9f3}` ùÑû 

## ùÑû Conclusion

En concluant, ce d√©fi de forensic nous a pr√©sent√© plusieurs obstacles, notamment la correction du CRC et l'ajustement de la hauteur de l'image. Gr√¢ce √† une analyse minutieuse et √† l'utilisation d'outils adapt√©s, nous avons pu r√©soudre le d√©fi avec succ√®s.










